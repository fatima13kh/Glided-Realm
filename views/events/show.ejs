<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= event.owner.username %>'s event</title>
  </head>
  <body>
    <%- include('../partials/_navbar.ejs') %>

    <h1>A event in <%= event.city %></h1>

    <h2>Details</h2>
   <p>Event Date: <%= event.eventDate.getFullYear() %>-<%= (event.eventDate.getMonth()+1).toString().padStart(2,'0') %>-<%= event.eventDate.getDate().toString().padStart(2,'0') %></p>
    <p>Start Time: <%= event.startTime %></p>
    <p>End Time: <%= event.endTime %></p>
    <p>Location: <%= event.location %></p>
    <p>Description: <%= event.description %></p>
    <p>Performers: <%= event.performers.join(', ') %></p>


    <h2>Favourites</h2>
<p>Favourited by <%= favouritedCount %> people.</p>

<form action="/events/<%= event._id %>/favourite" method="POST">
  <% if (user && userHasFavorited) { %>
    <button type="submit">Unfavourite</button>
  <% } else { %>
    <button type="submit">Favourite</button>
  <% } %>
</form>



<h2>Owner</h2>
<% if (user && event.owner._id.equals(user._id)) { %>
  <p>You own this!</p>

  <!-- Edit Button -->
  <form action="/events/<%= event._id %>/edit" method="GET" style="display:inline;">
    <button type="submit">Edit this event</button>
  </form>


  <!-- Delete Button -->
  <form action="/events/<%= event._id %>?_method=DELETE" method="POST">
    <button type="submit">Delete this event</button>
  </form>

   <% if (bookingMessage) { %>
  <p style="color: <%= bookingMessageColor || 'green' %>;">
    <%= bookingMessage %>
  </p>
<% } %>

    <!-- Attendees List -->
  <h3>Attendees (<%= event.attendees.length %>)</h3>
  <% if (event.attendees.length > 0) { %>
    <ul>
      <% event.attendees.forEach(att => { %>
        <li>
          <%= att.user.username %> - <%= att.quantity %> ticket(s) - Paid: <%= att.totalPaid.toFixed(3) %> BHD
        </li>
      <% }); %>
    </ul>
  <% } else { %>
    <p>No one has booked tickets yet.</p>
  <% } %>

  
<% } else { %>
  <p>Event Owner: <%= event.owner.username %></p>

<!-- Booking Form -->
<h3>Book Tickets</h3>

<% if (bookingMessage) { %>
  <p style="color: <%= bookingMessageColor || 'green' %>;">
    <%= bookingMessage %>
  </p>
<% } %>

<% if (event.ticketQuantity > 0) { %>
  <form action="/events/<%= event._id %>/book" method="POST">
    <label for="quantity">Number of Tickets:</label>
    <input 
      type="number" 
      name="quantity" 
      id="quantity" 
      min="1" 
      placeholder="Enter how many tickets you want" 
      required
    >
    <button type="submit">
      Book Tickets
    </button>
  </form>
<% } else { %>
  <p style="color:red;">Tickets are sold out.</p>
<% } %>



<% } %>




</body>
</html>
